---
layout: post
category: "java"
title:  "class热替换项目hot2hot"
tags: [java,class,hotcode,hotswap,reload]
---

我们用eclipse+tomcat开发web项目时，经常会这样做，修改个java文件，然后不需要重启tomcat就可以直接看到修改后的结果， 这就是热替换技术。

对热替换技术原理的探索源于hotswap，但是hotswap的限制比较多。用户手册：http://jm-blog.aliapp.com/?p=641

阿里自己实现了hotcode2，功能挺强大的，而且在不断的更新。

原理就是：切入java.lang.ClassLoader中的方法defineClass，通过asm将加载的类修改。比如在方法中加入代码，用于判断当前class是否修改过，如果修改过，就重新加载。

下面贴一张hotswap和hotcode2的比较图：

![hello](/img/hotcode2.png)

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

接下来简单说下hot2hot：

git地址：https://github.com/liuxinglanyue/hot2hot

首先通过javagent的方式切入， AgentMain类做了两件事儿。第一，修改java.lang.ClassLoader中的defineClass方法。第二，定时扫描一个文件夹，替换class。


